{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HypothesisFX",
  "description": "Schema for hypothesis proposals generated by the research pipeline.",
  "type": "object",
  "required": [
    "experiment_intent",
    "evidence_refs",
    "novelty_claim",
    "expected_mechanism",
    "predictions",
    "expected_failure_mode",
    "kill_criteria",
    "compute_budget",
    "sweep_config_yaml"
  ],
  "properties": {
    "experiment_intent": {
      "type": "string",
      "enum": ["gap_fill", "failure_mitigation", "robustness", "regime_test"],
      "description": "The intent/purpose of this experiment."
    },
    "evidence_refs": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1,
      "description": "References to previous sweeps that inform this hypothesis."
    },
    "novelty_claim": {
      "type": "object",
      "required": ["coverage_diff"],
      "properties": {
        "coverage_diff": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1,
          "description": "New coverage areas this experiment explores."
        },
        "near_dup_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Similarity score to nearest existing experiment (0=unique, 1=duplicate)."
        }
      },
      "description": "Claims about what makes this experiment novel."
    },
    "expected_mechanism": {
      "type": "string",
      "minLength": 50,
      "description": "Detailed explanation of the expected market mechanism."
    },
    "predictions": {
      "type": "object",
      "required": [
        "trade_duration_median_bars",
        "trades_per_day",
        "gross_minus_net_gap"
      ],
      "properties": {
        "trade_duration_median_bars": {
          "type": "number",
          "minimum": 1,
          "description": "Expected median trade duration in bars."
        },
        "trades_per_day": {
          "type": "number",
          "minimum": 0,
          "description": "Expected number of trades per day."
        },
        "gross_minus_net_gap": {
          "type": "number",
          "description": "Expected difference between gross and net returns."
        }
      },
      "description": "Quantitative predictions for audit."
    },
    "expected_failure_mode": {
      "type": "string",
      "description": "Most likely failure mode if the experiment doesn't work."
    },
    "kill_criteria": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1,
      "description": "Conditions that would invalidate this hypothesis."
    },
    "compute_budget": {
      "type": "object",
      "required": ["max_variants", "max_runtime_minutes"],
      "properties": {
        "max_variants": {
          "type": "integer",
          "minimum": 1,
          "maximum": 500,
          "description": "Maximum number of parameter combinations to test."
        },
        "max_runtime_minutes": {
          "type": "integer",
          "minimum": 1,
          "maximum": 120,
          "description": "Maximum runtime in minutes."
        }
      },
      "description": "Computational budget constraints."
    },
    "sweep_config_yaml": {
      "type": "string",
      "minLength": 10,
      "description": "YAML configuration for the sweep."
    }
  }
}
